#!/bin/sh
// 2>/dev/null; exec "$(command -v bun 2>/dev/null || echo node)" "$0" "$@"
import{relative as Jq,dirname as wq,join as xQ}from"path";import{existsSync as l$}from"fs";import{homedir as Xq,platform as VQ}from"os";import{join as w,parse as GQ,dirname as Yq}from"path";import{existsSync as E$}from"fs";import{fileURLToPath as _Q}from"url";var LQ=_Q(import.meta.url),W$=Yq(LQ),UQ=()=>{let $=Xq();switch(VQ()){case"darwin":return w($,"Library","Application Support","Code","User");case"win32":return w($,"AppData","Roaming","Code","User");case"linux":return w($,".config","Code","User");default:return w($,".config","Code","User")}},vQ=()=>{let $=process.cwd(),q=GQ($).root;while($!==q){if(E$(w($,".agents")))return $;$=Yq($)}return process.cwd()},H={home:Xq(),vscodeUserDir:UQ(),projectRoot:vQ(),get projectClaudeSkills(){return w(this.projectRoot,".claude","skills")},get projectAgentsSkills(){return w(this.projectRoot,".agents","skills")},get projectCopilotSkills(){return w(this.projectRoot,".copilot","skills")},get projectOpencodeSkills(){return w(this.projectRoot,".opencode","skill")},get projectCursorSkills(){return w(this.projectRoot,".cursor","skills")},get projectGeminiSkills(){return w(this.projectRoot,".gemini","skills")},get projectCodexSkills(){return w(this.projectRoot,".codex","skills")},get projectSkillsDir(){return w(this.projectRoot,"skills")},get homePersonalSkills(){return w(this.home,".agents","skills")},get homeClaudeSkills(){return w(this.home,".claude","skills")},get homeCopilotSkills(){return w(this.home,".copilot","skills")},get homeOpencodeSkills(){return w(this.home,".config","opencode","skill")},get homeCursorSkills(){return w(this.home,".cursor","skills")},get homeGeminiSkills(){return w(this.home,".gemini","skills")},get homeCodexSkills(){return w(this.home,".codex","skills")},get bootstrap(){return w(this.projectRoot,".agents","superpowers-bootstrap.md")},get superpowersRepo(){let $=w(W$,"..","..","..","skills");if(E$($)&&E$(w(W$,"..","..","..",".github","prompts")))return w(W$,"..","..","..");return w(this.home,".agents","superpowers")},get homeSuperpowersSkills(){return w(this.superpowersRepo,"skills")},get isSuperpowersRepo(){let $=w(W$,"..","..","..","skills");return E$($)&&E$(w(W$,"..","..","..",".github","prompts"))}};import{readFileSync as Zq}from"fs";var z$=($)=>{try{let Q=Zq($,"utf8").split(`
`),Y={name:"",description:"",whenToUse:""},X=!1;for(let Z of Q){if(Z.trim()==="---"){if(X)break;X=!0;continue}if(X){let W=Z.match(/^(\w+):\s*(.*)$/);if(W){let[,E,V]=W,z={name:"name",description:"description",when_to_use:"whenToUse"};if(z[E])Y[z[E]]=V.trim()}}}return Y}catch{return{name:"",description:"",whenToUse:""}}},Hq=($)=>{try{let q=Zq($,"utf8"),Q=z$($),Y=q.split(`
`),X=!1,Z=!1,W=[];for(let E of Y){if(E.trim()==="---"){if(X){Z=!0;continue}X=!0;continue}if(Z||!X)W.push(E)}return{content:W.join(`
`).trim(),frontmatter:Q}}catch(q){throw Error(`Error reading skill file: ${q.message}`)}};import{existsSync as h$,readdirSync as zq,statSync as Kq}from"fs";import{join as m$,relative as gX}from"path";import{readFileSync as OQ,existsSync as IQ}from"fs";import{join as Wq}from"path";var K$=($)=>{let q=Wq($,"skill.json");if(!IQ(q))return null;try{let Q=OQ(q,"utf8");return JSON.parse(Q)}catch(Q){return null}};var d$=($)=>{if($.startsWith("superpowers:"))return{type:"superpowers",path:$.substring(12).replace(/^skills\//,"")};if($.startsWith("claude:"))return{type:"claude",path:$.substring(7).replace(/^skills\//,"")};if($.startsWith("copilot:"))return{type:"copilot",path:$.substring(8).replace(/^skills\//,"")};if($.startsWith("opencode:"))return{type:"opencode",path:$.substring(9).replace(/^skills\//,"")};if($.startsWith("cursor:"))return{type:"cursor",path:$.substring(7).replace(/^skills\//,"")};if($.startsWith("gemini:"))return{type:"gemini",path:$.substring(7).replace(/^skills\//,"")};return{type:null,path:$.replace(/^skills\//,"")}},Eq=($,q)=>{let Q=K$($);if(!Q||!Q.helpers||!Array.isArray(Q.helpers))return null;let Y=Q.helpers,X=q.toLowerCase(),Z=null,W=0;for(let E of Y){let V=E.toLowerCase();if(V===X){Z=E;break}if(V.includes(X)){let K=X.length/V.length;if(K>W)W=K,Z=E}let z=E.split("/").pop().split(".")[0].toLowerCase();if(X.includes(z)){let K=z.length/X.length;if(K>W)W=K,Z=E}}return Z?Wq($,Z):null},B$={project:{dir:"projectAgentsSkills",prefix:""},claude:{dir:"projectClaudeSkills",prefix:"claude:"},copilot:{dir:"projectCopilotSkills",prefix:"copilot:"},opencode:{dir:"projectOpencodeSkills",prefix:"opencode:"},cursor:{dir:"projectCursorSkills",prefix:"cursor:"},gemini:{dir:"projectGeminiSkills",prefix:"gemini:"},personal:{dir:"homePersonalSkills",prefix:""},personalClaude:{dir:"homeClaudeSkills",prefix:"claude:"},personalCopilot:{dir:"homeCopilotSkills",prefix:"copilot:"},personalOpencode:{dir:"homeOpencodeSkills",prefix:"opencode:"},personalCursor:{dir:"homeCursorSkills",prefix:"cursor:"},personalGemini:{dir:"homeGeminiSkills",prefix:"gemini:"},superpowers:{dir:"homeSuperpowersSkills",prefix:"superpowers:"}};var A$=($,q,Q=null)=>{let Y=[];if(!h$($))return Y;let X=(Z,W)=>{if(Q!==null&&W>Q)return;try{let E=zq(Z,{withFileTypes:!0});for(let V of E){if(V.name==="node_modules"||V.name===".git"||V.name.startsWith("."))continue;let z=m$(Z,V.name),K=V.isDirectory();if(V.isSymbolicLink())try{K=Kq(z).isDirectory()}catch{continue}if(!K)continue;let G=m$(z,"SKILL.md");if(h$(G))Y.push(z);if(Q===null||W<Q)X(z,W+1)}}catch{}};return X($,0),Y};var Bq=($,q)=>{if(!h$($))return[];let Q=[],Y=q.toLowerCase().replace(/\\/g,"/"),X=(Z,W="")=>{try{let E=zq(Z,{withFileTypes:!0});for(let V of E){let z=m$(Z,V.name),K=W?`${W}/${V.name}`:V.name,G=V.isDirectory();if(V.isSymbolicLink())try{G=Kq(z).isDirectory()}catch{continue}if(G&&(V.name==="node_modules"||V.name===".git"||V.name.startsWith(".")))continue;if(G)X(z,K);else if(V.name==="SKILL.md"){let L=W.toLowerCase().replace(/\\/g,"/");if(L===Y||L.endsWith("/"+Y)||L.endsWith(Y))Q.push({file:z,path:W})}}}catch(E){}};return X($),Q},Vq=($,q,Q)=>{let Y={project:"project skills (.agents/skills/)",claude:"claude skills (.claude/skills/)",copilot:"copilot skills (.copilot/skills/)",opencode:"opencode skills (.opencode/skill/)",cursor:"cursor skills (.cursor/skills/)",gemini:"gemini skills (.gemini/skills/)",personal:"personal skills (~/.agents/skills/)",personalClaude:"personal claude skills (~/.claude/skills/)",personalCopilot:"personal copilot skills (~/.copilot/skills/)",personalOpencode:"personal opencode skills (~/.config/opencode/skill/)",personalCursor:"personal cursor skills (~/.cursor/skills/)",personalGemini:"personal gemini skills (~/.gemini/skills/)",superpowers:"superpowers skills (~/.agents/superpowers/skills/)"}[Q];console.log(`Error: Multiple skills match "${$}" in ${Y}:
`);for(let X of q){let W=B$[Q].prefix+X.path;try{let E=z$(X.file),V=E.description||E.whenToUse||"(no description)";console.log(`  ${W}`),console.log(`    ${V}
`)}catch(E){console.log(`  ${W}`),console.log(`    (unable to read description)
`)}}console.log("Please be more specific. Examples:");for(let X of q.slice(0,2)){let Z=B$[Q].prefix;console.log(`  superpowers-agent execute ${Z}${X.path}`)}};import{existsSync as p$}from"fs";import{join as JQ,relative as wQ}from"path";var AQ=($)=>{let{type:q,path:Q}=d$($),Y={superpowers:[H.homeSuperpowersSkills],claude:[H.projectClaudeSkills,H.homeClaudeSkills],copilot:[H.projectCopilotSkills,H.homeCopilotSkills],opencode:[H.projectOpencodeSkills,H.homeOpencodeSkills],gemini:[H.projectGeminiSkills,H.homeGeminiSkills],project:[H.projectAgentsSkills],personal:[H.homePersonalSkills]},X;if(q)X=(Y[q]||[]).map((W)=>({type:q,dir:W}));else if(H.isSuperpowersRepo&&p$(H.projectSkillsDir))X=[{type:"project",dir:H.projectSkillsDir},{type:"project",dir:H.projectAgentsSkills},{type:"claude",dir:H.projectClaudeSkills},{type:"copilot",dir:H.projectCopilotSkills},{type:"opencode",dir:H.projectOpencodeSkills},{type:"gemini",dir:H.projectGeminiSkills},{type:"personal",dir:H.homePersonalSkills},{type:"personalClaude",dir:H.homeClaudeSkills},{type:"personalCopilot",dir:H.homeCopilotSkills},{type:"personalOpencode",dir:H.homeOpencodeSkills},{type:"personalGemini",dir:H.homeGeminiSkills},{type:"superpowers",dir:H.homeSuperpowersSkills}];else X=[{type:"project",dir:H.projectAgentsSkills},{type:"claude",dir:H.projectClaudeSkills},{type:"copilot",dir:H.projectCopilotSkills},{type:"opencode",dir:H.projectOpencodeSkills},{type:"gemini",dir:H.projectGeminiSkills},{type:"personal",dir:H.homePersonalSkills},{type:"personalClaude",dir:H.homeClaudeSkills},{type:"personalCopilot",dir:H.homeCopilotSkills},{type:"personalOpencode",dir:H.homeOpencodeSkills},{type:"personalGemini",dir:H.homeGeminiSkills},{type:"superpowers",dir:H.homeSuperpowersSkills}];for(let{type:Z,dir:W}of X){let E=Bq(W,Q);if(E.length===1)return{skillFile:E[0].file,sourceType:Z,actualSkillPath:E[0].path};if(E.length>1)Vq(Q,E,Z)}return null},h=($)=>{let q=AQ($);if(q)return q;let{type:Q,path:Y}=d$($),X={superpowers:[H.homeSuperpowersSkills],claude:[H.projectClaudeSkills,H.homeClaudeSkills],copilot:[H.projectCopilotSkills,H.homeCopilotSkills],opencode:[H.projectOpencodeSkills,H.homeOpencodeSkills],gemini:[H.projectGeminiSkills,H.homeGeminiSkills],project:[H.projectAgentsSkills],personal:[H.homePersonalSkills]},Z;if(Q)Z=(X[Q]||[]).map((E)=>({type:Q,dir:E}));else if(H.isSuperpowersRepo&&p$(H.projectSkillsDir))Z=[{type:"project",dir:H.projectSkillsDir},{type:"project",dir:H.projectAgentsSkills},{type:"claude",dir:H.projectClaudeSkills},{type:"copilot",dir:H.projectCopilotSkills},{type:"opencode",dir:H.projectOpencodeSkills},{type:"gemini",dir:H.projectGeminiSkills},{type:"personal",dir:H.homePersonalSkills},{type:"personalClaude",dir:H.homeClaudeSkills},{type:"personalCopilot",dir:H.homeCopilotSkills},{type:"personalOpencode",dir:H.homeOpencodeSkills},{type:"personalGemini",dir:H.homeGeminiSkills},{type:"superpowers",dir:H.homeSuperpowersSkills}];else Z=[{type:"project",dir:H.projectAgentsSkills},{type:"claude",dir:H.projectClaudeSkills},{type:"copilot",dir:H.projectCopilotSkills},{type:"opencode",dir:H.projectOpencodeSkills},{type:"gemini",dir:H.projectGeminiSkills},{type:"personal",dir:H.homePersonalSkills},{type:"personalClaude",dir:H.homeClaudeSkills},{type:"personalCopilot",dir:H.homeCopilotSkills},{type:"personalOpencode",dir:H.homeOpencodeSkills},{type:"personalGemini",dir:H.homeGeminiSkills},{type:"superpowers",dir:H.homeSuperpowersSkills}];for(let{type:W,dir:E}of Z){if(!p$(E))continue;let V=A$(E,W,null);for(let z of V){let K=K$(z);if(K&&K.aliases&&Array.isArray(K.aliases)){let G=Y.toLowerCase();for(let L of K.aliases)if(L.toLowerCase()===G){let B=JQ(z,"SKILL.md"),U=wQ(E,z);return{skillFile:B,sourceType:W,actualSkillPath:U}}}}}return null};import{readFileSync as Gq,writeFileSync as _q,existsSync as n$}from"fs";import{join as m}from"path";import{execSync as TQ}from"child_process";var c$=()=>({auto_update:!0,last_update_check:null,last_updated_commit:null}),V$=()=>{let $=m(H.superpowersRepo,".config.json");try{if(!n$($))return c$();let q=Gq($,"utf8");return{...c$(),...JSON.parse(q)}}catch{return c$()}},T$=($)=>{let q=m(H.superpowersRepo,".config.json"),Y={...V$(),...$};try{_q(q,JSON.stringify(Y,null,2))}catch(X){console.log(`Warning: couldn't save config: ${X.message}`)}},p=($)=>{let q=$?m(H.home,".agents","config.json"):m(process.cwd(),".agents","config.json");if(!n$(q))return{};try{let Q=Gq(q,"utf8");return JSON.parse(Q)}catch(Q){return{}}},o=($,q)=>{let Q=q?m(H.home,".agents"):m(process.cwd(),".agents"),Y=m(Q,"config.json");try{if(!n$(Q))TQ(`mkdir -p "${Q}"`,{stdio:"pipe"});return _q(Y,JSON.stringify($,null,2),"utf8"),!0}catch(X){throw Error(`Failed to write config: ${X.message}`)}},g=($=!1)=>{return p($).repositories||{}},Lq=($,q,Q)=>{let Y=p(Q);if(!Y.repositories)Y.repositories={};Y.repositories[$]=q,o(Y,Q)};import{readFileSync as bQ}from"fs";import{join as Uq,dirname as MQ}from"path";import{fileURLToPath as NQ}from"url";import{existsSync as FQ}from"fs";import{execSync as CQ}from"child_process";var RQ=NQ(import.meta.url),vq=MQ(RQ),k=()=>{try{let $=Uq(vq,"package.json");if(!FQ($))$=Uq(vq,"..","..","package.json");return JSON.parse(bQ($,"utf8")).version||"5.4.0"}catch($){return"5.4.0"}},x=()=>{let $=k();console.log(`^^SAV:${$}^^`)},Oq=async()=>{try{let q=CQ('curl -sS "https://raw.githubusercontent.com/complexthings/superpowers/main/.agents/package.json"',{encoding:"utf8",timeout:1e4}),Q=JSON.parse(q);if(!Q.version)return k();return Q.version}catch($){throw Error(`Failed to fetch remote version: ${$.message}`)}},Iq=($,q)=>{let Q=$.split(".").map(Number),Y=q.split(".").map(Number);for(let X=0;X<3;X++){let Z=Q[X]||0,W=Y[X]||0;if(Z>W)return!0;if(Z<W)return!1}return!1};var DQ={project:{dir:"projectAgentsSkills",prefix:""},claude:{dir:"projectClaudeSkills",prefix:"claude:"},copilot:{dir:"projectCopilotSkills",prefix:"copilot:"},opencode:{dir:"projectOpencodeSkills",prefix:"opencode:"},gemini:{dir:"projectGeminiSkills",prefix:"gemini:"},personal:{dir:"homePersonalSkills",prefix:""},personalClaude:{dir:"homeClaudeSkills",prefix:"claude:"},personalCopilot:{dir:"homeCopilotSkills",prefix:"copilot:"},personalOpencode:{dir:"homeOpencodeSkills",prefix:"opencode:"},personalGemini:{dir:"homeGeminiSkills",prefix:"gemini:"},superpowers:{dir:"homeSuperpowersSkills",prefix:"superpowers:"}},jQ=($,q)=>{let Q=xQ($,"SKILL.md"),{dir:Y,prefix:X}=DQ[q],Z=Jq(H[Y],$).replace(/\\/g,"/");console.log(`${X}${Z}`);let{description:W,whenToUse:E}=z$(Q);if(W)console.log(`  ${W}`);if(E)console.log(`  When to use: ${E}`);console.log("")},i=()=>{x();let $=new Set,q=[{type:"project",dir:H.projectAgentsSkills,maxDepth:null},{type:"claude",dir:H.projectClaudeSkills,maxDepth:null},{type:"copilot",dir:H.projectCopilotSkills,maxDepth:null},{type:"opencode",dir:H.projectOpencodeSkills,maxDepth:null},{type:"gemini",dir:H.projectGeminiSkills,maxDepth:null},{type:"personal",dir:H.homePersonalSkills,maxDepth:null},{type:"personalClaude",dir:H.homeClaudeSkills,maxDepth:null},{type:"personalCopilot",dir:H.homeCopilotSkills,maxDepth:null},{type:"personalOpencode",dir:H.homeOpencodeSkills,maxDepth:null},{type:"personalGemini",dir:H.homeGeminiSkills,maxDepth:null},{type:"superpowers",dir:H.homeSuperpowersSkills,maxDepth:null}];for(let{type:Q,dir:Y,maxDepth:X}of q){let Z=A$(Y,Q,X);for(let W of Z){let E=Jq(Y,W);if(!$.has(E))$.add(E),jQ(W,Q)}}console.log(`Usage:
  superpowers-agent execute <skill-name> # Load a specific skill`)},Aq=()=>{x();let $=process.argv[3];if(!$){console.log(`Usage: superpowers-agent execute <skill-name-or-alias>

Examples:
  superpowers-agent execute brainstorming
  superpowers-agent execute superpowers:collaboration/brainstorming
  superpowers-agent execute aem/block-collection-and-party
  superpowers-agent execute block-collection  # Using alias

Description:
  Instructs the agent to execute the specified skill.
  Supports skill aliases defined in skill.json files.`);return}let q=h($);if(!q){console.log(`Error: Skill not found: ${$}

Available skills:`),i();return}let{skillFile:Q,sourceType:Y}=q,X=process.cwd(),Z=Q.startsWith(X),W=l$(H.projectAgentsSkills)||l$(H.projectClaudeSkills);if(Z)console.log(`Open this file with your Read Tool: ${Q}

<IMPORTANT>
USE YOUR Read Tool to process this file. DO NOT use \`cat\` or print commands.
</IMPORTANT>`);else if(W&&Y!=="project")console.log(`Open this file with your Read Tool: ${Q}

<IMPORTANT>
1. Try using your Read Tool first
2. If your Read tool fails (file outside workspace), use: cat "${Q}"
3. Consider using workspace-local skills for better tool compatibility
   Run: superpowers-agent setup-skills
</IMPORTANT>`);else console.log(`Open this file with your Read Tool: ${Q}

<IMPORTANT>
1. Try using your Read Tool first
2. If your Read tool fails (file outside workspace), use: cat "${Q}"
3. NEVER skip loading the skill content
</IMPORTANT>`)},Tq=()=>{let $=process.argv[3];if(!$){console.log(`Usage: superpowers-agent path <skill-name-or-alias>

Examples:
  superpowers-agent path brainstorming
  superpowers-agent path superpowers:collaboration/brainstorming
  superpowers-agent path aem/block-collection-and-party
  superpowers-agent path block-collection  # Using alias

Description:
  Outputs the file system path of the specified SKILL.md file.
  Supports skill aliases defined in skill.json files.`);return}let q=h($);if(!q){console.log(`Error: Skill not found: ${$}

Available skills:`),i();return}let{skillFile:Q}=q;console.log(Q)},bq=()=>{let $=process.argv[3];if(!$){console.log(`Usage: superpowers-agent dir <skill-name>

Examples:
  superpowers-agent dir brainstorming
  superpowers-agent dir aem/block-collection-and-party
  superpowers-agent dir block-collection  # Using alias
  superpowers-agent dir superpowers:testing/test-driven-development

Description:
  Returns the directory path where the specified skill is located.
  Supports skill aliases defined in skill.json files.`);return}let q=h($);if(!q){console.log(`Error: Skill not found: ${$}

Available skills:`),i();return}let{skillFile:Q}=q,Y=wq(Q);console.log(Y)},Mq=()=>{x();let $=process.argv[3],q=process.argv[4];if(!$||!q){console.log(`Usage: superpowers-agent get-helpers <skill-name> <helper-search-term>

Examples:
  superpowers-agent get-helpers block-collection search-block
  superpowers-agent get-helpers aem/block-collection-and-party get-block-structure
  superpowers-agent get-helpers superpowers:testing/test-driven-development example

Description:
  Searches for helper files within a skill's skill.json configuration.
  Returns the full path to the best matching helper file.
  
  The command uses the skill's aliases if available, so you can use
  short names like "block-collection" instead of the full path.`);return}let Q=h($);if(!Q){console.log(`Error: Skill not found: ${$}

Available skills:`),i();return}let{skillFile:Y}=Q,X=wq(Y),Z=K$(X);if(!Z){console.log(`Error: No skill.json found for skill: ${$}
  Location: ${X}`);return}if(!Z.helpers||!Array.isArray(Z.helpers)||Z.helpers.length===0){console.log(`Error: No helpers defined in skill.json for skill: ${$}
  Location: ${X}`);return}let W=Eq(X,q);if(!W){console.log(`Error: No helper found matching "${q}" in skill: ${$}`),console.log(`
Available helpers:`);for(let E of Z.helpers)console.log(`  - ${E}`);return}if(!l$(W)){console.log(`Error: Helper file not found: ${W}
  Defined in skill.json but missing from filesystem`);return}console.log(W)},Nq=()=>{let $=V$();console.log("Current configuration:"),console.log(JSON.stringify($,null,2))},Fq=()=>{let $=process.argv[3],q=process.argv[4];if(!$||q===void 0){console.log(`Usage: .agents/superpowers-agent config-set <key> <value>

Available keys:
  auto_update (true/false) - Enable/disable automatic updates during bootstrap

Examples:
  .agents/superpowers-agent config-set auto_update false
  .agents/superpowers-agent config-set auto_update true`);return}let Q=q;if(q==="true")Q=!0;else if(q==="false")Q=!1;let Y={};Y[$]=Q,T$(Y),console.log(`✓ Set ${$} = ${Q}`)},Cq=()=>{x();let $=g(!0),q=g(!1),Q=[];for(let[Z,W]of Object.entries($))Q.push({alias:Z,url:W,source:"global"});for(let[Z,W]of Object.entries(q)){let E=Q.findIndex((V)=>V.alias===Z);if(E>=0)Q[E]={alias:Z,url:W,source:"project"};else Q.push({alias:Z,url:W,source:"project"})}if(Q.length===0){console.log(`No repository aliases configured.

Add a repository using:
  superpowers-agent add-repository <git-url> [--as=@alias]`);return}let Y=Math.max(5,...Q.map((Z)=>Z.alias.length)),X=Math.max(3,...Q.map((Z)=>Z.url.length));console.log(`Repositories:
`),console.log(`${"Alias".padEnd(Y)}  ${"URL".padEnd(X)}  Source`);for(let Z of Q)console.log(`${Z.alias.padEnd(Y)}  ${Z.url.padEnd(X)}  (${Z.source})`);console.log(`
Total: ${Q.length} repository alias(es)`)};import{execSync as $X}from"child_process";import{execSync as c}from"child_process";var PQ=()=>{try{return c("git status --porcelain --untracked-files=no",{cwd:H.superpowersRepo,encoding:"utf8",stdio:"pipe",timeout:3000}).trim().length===0}catch{return!1}},G$=()=>{try{return c("git rev-parse --abbrev-ref HEAD",{cwd:H.superpowersRepo,encoding:"utf8",stdio:"pipe",timeout:3000}).trim()==="main"}catch{return!1}},b$=()=>{try{c("git fetch origin",{cwd:H.superpowersRepo,timeout:5000,stdio:"pipe"});let $=!PQ(),q=c("git rev-parse HEAD",{cwd:H.superpowersRepo,encoding:"utf8",stdio:"pipe"}).trim(),Q=c("git rev-parse origin/main",{cwd:H.superpowersRepo,encoding:"utf8",stdio:"pipe"}).trim();if(q===Q)return{hasUpdates:!1,hasLocalChanges:$,currentCommit:q,latestCommit:Q,commitsBehind:0,changedFiles:[]};let X=parseInt(c("git rev-list --count HEAD..origin/main",{cwd:H.superpowersRepo,encoding:"utf8",stdio:"pipe"}).trim(),10),W=c("git diff --name-only HEAD origin/main",{cwd:H.superpowersRepo,encoding:"utf8",stdio:"pipe"}).trim().split(`
`).filter((E)=>E.length>0);return{hasUpdates:!0,hasLocalChanges:$,currentCommit:q,latestCommit:Q,commitsBehind:X,changedFiles:W}}catch{return{hasUpdates:!1,hasLocalChanges:!1,currentCommit:"",latestCommit:"",commitsBehind:0,changedFiles:[],error:!0}}},Rq=($)=>{let q={".github/prompts/":"copilot-prompts",".cursor/commands/":"cursor-commands","hooks/cursor/":"cursor-hooks",".codex/prompts/":"codex-prompts",".gemini/commands/":"gemini-commands","commands/":"claude-commands",".opencode/command/":"opencode-commands",".opencode/plugins/":"opencode-plugin"},Q=new Set;for(let Y of $)for(let[X,Z]of Object.entries(q))if(Y.startsWith(X))Q.add(Z);return Array.from(Q)};import{existsSync as xq,readdirSync as fQ}from"fs";import{join as M$}from"path";import{execSync as Dq}from"child_process";var r=()=>{let $=M$(H.superpowersRepo,".github","prompts"),q=M$(H.vscodeUserDir,"prompts");if(!xq($)){console.log("⚠️  No Copilot prompts to install (source directory not found).");return}try{if(!xq(q))Dq(`mkdir -p "${q}"`,{stdio:"pipe"})}catch(X){console.log(`Error creating prompts directory: ${X.message}`);return}let Q;try{Q=fQ($).filter((X)=>X.endsWith(".prompt.md"))}catch(X){console.log(`Error reading prompts directory: ${X.message}`);return}if(Q.length===0){console.log("⚠️  No prompt files found to install.");return}console.log("Installing GitHub Copilot prompts...");let Y=0;for(let X of Q)try{let Z=M$($,X),W=M$(q,X);Dq(`cp "${Z}" "${W}"`,{stdio:"pipe"}),console.log(`  ✓ Installed ${X}`),Y++}catch(Z){console.log(`  ✗ Failed to install ${X}: ${Z.message}`)}if(Y>0)console.log(`
✓ Installed ${Y} prompt(s) to ${q}
  Use slash commands in GitHub Copilot:
    /brainstorm-with-superpowers - Refine ideas into designs
    /write-a-skill - Create new skills with TDD
    /skills - Discover available skills
    /use-skill - Load and apply a specific skill`)};import{existsSync as N$,readdirSync as jq}from"fs";import{join as D}from"path";import{execSync as s}from"child_process";var t=()=>{let $=D(H.superpowersRepo,".cursor","commands"),q=D(H.home,".cursor","commands");if(!N$($)){console.log("⚠️  No Cursor commands to install (source directory not found).");return}try{if(!N$(q))s(`mkdir -p "${q}"`,{stdio:"pipe"})}catch(X){console.log(`Error creating Cursor commands directory: ${X.message}`);return}let Q;try{Q=jq($).filter((X)=>X.endsWith(".md"))}catch(X){console.log(`Error reading Cursor commands directory: ${X.message}`);return}if(Q.length===0){console.log("⚠️  No command files found to install.");return}console.log("Installing Cursor commands...");let Y=0;for(let X of Q)try{let Z=D($,X),W=D(q,X);s(`cp "${Z}" "${W}"`,{stdio:"pipe"}),console.log(`  ✓ Installed ${X}`),Y++}catch(Z){console.log(`  ✗ Failed to install ${X}: ${Z.message}`)}if(Y>0)console.log(`
✓ Installed ${Y} command(s) to ${q}
  Use slash commands in Cursor:
    /brainstorm-with-superpowers - Refine ideas into designs
    /write-a-skill - Create new skills with TDD
    /skills - Discover available skills
    /use-skill - Load and apply a specific skill`)},e=()=>{let $=D(H.superpowersRepo,"hooks","cursor"),q=D(H.home,".cursor","hooks"),Q=D($,"hooks.json"),Y=D(H.home,".cursor","hooks.json");if(!N$($)){console.log("⚠️  No Cursor hooks to install (source directory not found).");return}try{if(!N$(q))s(`mkdir -p "${q}"`,{stdio:"pipe"})}catch(W){console.log(`Error creating Cursor hooks directory: ${W.message}`);return}try{s(`cp "${Q}" "${Y}"`,{stdio:"pipe"}),console.log("  ✓ Installed hooks.json")}catch(W){console.log(`  ✗ Failed to install hooks.json: ${W.message}`);return}let X;try{X=jq($).filter((W)=>W.endsWith(".sh"))}catch(W){console.log(`Error reading hooks directory: ${W.message}`);return}if(X.length===0){console.log("⚠️  No hook scripts found to install.");return}console.log("Installing Cursor hooks...");let Z=0;for(let W of X)try{let E=D($,W),V=D(q,W);s(`cp "${E}" "${V}"`,{stdio:"pipe"}),s(`chmod +x "${V}"`,{stdio:"pipe"}),console.log(`  ✓ Installed ${W}`),Z++}catch(E){console.log(`  ✗ Failed to install ${W}: ${E.message}`)}if(Z>0)console.log(`
✓ Installed ${Z} hook(s) to ${q}
  Cursor will now check for skills before each prompt submission
  Restart Cursor for hooks to take effect`)};import{existsSync as Pq,readdirSync as SQ}from"fs";import{join as F$}from"path";import{execSync as fq}from"child_process";var $$=()=>{let $=F$(H.superpowersRepo,".codex","prompts"),q=F$(H.home,".codex","prompts");if(!Pq($)){console.log("⚠️  No Codex prompts to install (source directory not found).");return}try{if(!Pq(q))fq(`mkdir -p "${q}"`,{stdio:"pipe"})}catch(X){console.log(`Error creating Codex prompts directory: ${X.message}`);return}let Q;try{Q=SQ($).filter((X)=>X.endsWith(".md"))}catch(X){console.log(`Error reading Codex prompts directory: ${X.message}`);return}if(Q.length===0){console.log("⚠️  No prompt files found to install.");return}console.log("Installing OpenAI Codex prompts...");let Y=0;for(let X of Q)try{let Z=F$($,X),W=F$(q,X);fq(`cp "${Z}" "${W}"`,{stdio:"pipe"}),console.log(`  ✓ Installed ${X}`),Y++}catch(Z){console.log(`  ✗ Failed to install ${X}: ${Z.message}`)}if(Y>0)console.log(`
✓ Installed ${Y} prompt(s) to ${q}
  Use slash commands in OpenAI Codex:
    /prompts:brainstorm - Refine ideas into designs
    /prompts:write-skill - Create new skills with TDD
    /prompts:skills - Discover available skills
    /prompts:use-skill - Load and apply a specific skill
  Note: Restart Codex or open a new session to reload prompts`)};import{existsSync as Sq,readdirSync as yQ}from"fs";import{join as C$}from"path";import{execSync as yq}from"child_process";var q$=()=>{let $=C$(H.superpowersRepo,".gemini","commands"),q=C$(H.home,".gemini","commands");if(!Sq($)){console.log("⚠️  No Gemini commands to install (source directory not found).");return}try{if(!Sq(q))yq(`mkdir -p "${q}"`,{stdio:"pipe"})}catch(X){console.log(`Error creating Gemini commands directory: ${X.message}`);return}let Q;try{Q=yQ($).filter((X)=>X.endsWith(".toml"))}catch(X){console.log(`Error reading Gemini commands directory: ${X.message}`);return}if(Q.length===0){console.log("⚠️  No command files found to install.");return}console.log("Installing Gemini commands...");let Y=0;for(let X of Q)try{let Z=C$($,X),W=C$(q,X);yq(`cp "${Z}" "${W}"`,{stdio:"pipe"}),console.log(`  ✓ Installed ${X}`),Y++}catch(Z){console.log(`  ✗ Failed to install ${X}: ${Z.message}`)}if(Y>0)console.log(`
✓ Installed ${Y} command(s) to ${q}
  Use slash commands in Gemini:
    /brainstorm-with-superpowers - Refine ideas into designs
    /write-a-skill - Create new skills with TDD
    /skills - Discover available skills
    /use-skill - Load and apply a specific skill`)};import{existsSync as gq,readdirSync as gQ}from"fs";import{join as R$}from"path";import{execSync as kq}from"child_process";var Q$=()=>{let $=R$(H.superpowersRepo,"commands"),q=R$(H.home,".claude","commands");if(!gq($)){console.log("⚠️  No Claude commands to install (source directory not found).");return}try{if(!gq(q))kq(`mkdir -p "${q}"`,{stdio:"pipe"})}catch(X){console.log(`Error creating Claude commands directory: ${X.message}`);return}let Q;try{Q=gQ($).filter((X)=>X.endsWith(".md"))}catch(X){console.log(`Error reading Claude commands directory: ${X.message}`);return}if(Q.length===0){console.log("⚠️  No command files found to install.");return}console.log("Installing Claude Code commands...");let Y=0;for(let X of Q)try{let Z=R$($,X),W=R$(q,X);kq(`cp "${Z}" "${W}"`,{stdio:"pipe"}),console.log(`  ✓ Installed ${X}`),Y++}catch(Z){console.log(`  ✗ Failed to install ${X}: ${Z.message}`)}if(Y>0)console.log(`
✓ Installed ${Y} command(s) to ${q}
  Use slash commands in Claude Code:
    /brainstorm - Refine ideas into designs
    /execute-plan - Execute plans in batches
    /write-plan - Create implementation plans
    /skills - Discover available skills
    /use-skill - Load and apply a specific skill`)};import{existsSync as _$,readdirSync as kQ,lstatSync as uQ,symlinkSync as uq,unlinkSync as dQ,mkdirSync as hQ,readlinkSync as mQ}from"fs";import{join as n,dirname as nY}from"path";import{execSync as dq}from"child_process";import{platform as pQ}from"os";var X$=()=>{let $=n(H.superpowersRepo,".opencode","command"),q=n(H.home,".config","opencode","command");if(!_$($)){console.log("⚠️  No opencode commands to install (source directory not found).");return}try{if(!_$(q))dq(`mkdir -p "${q}"`,{stdio:"pipe"})}catch(X){console.log(`Error creating opencode commands directory: ${X.message}`);return}let Q;try{Q=kQ($).filter((X)=>X.endsWith(".md"))}catch(X){console.log(`Error reading opencode commands directory: ${X.message}`);return}if(Q.length===0){console.log("⚠️  No command files found to install.");return}console.log("Installing opencode commands...");let Y=0;for(let X of Q)try{let Z=n($,X),W=n(q,X);dq(`cp "${Z}" "${W}"`,{stdio:"pipe"}),console.log(`  ✓ Installed ${X}`),Y++}catch(Z){console.log(`  ✗ Failed to install ${X}: ${Z.message}`)}if(Y>0)console.log(`
✓ Installed ${Y} command(s) to ${q}
  Use slash commands in opencode:
    /brainstorm - Refine ideas into designs
    /execute-plan - Execute plans in batches
    /write-plan - Create implementation plans
    /write-skill - Create new skills with TDD
    /skills - Discover available skills
    /use-skill - Load and apply a specific skill`)},a$=($)=>{try{return uQ($).isSymbolicLink()}catch{return!1}},cQ=($,q)=>{try{if(!a$($))return!1;return mQ($)===q}catch{return!1}},L$=()=>{let $=n(H.superpowersRepo,".opencode","plugins","superpowers-agent.js"),q=n(H.home,".config","opencode","plugins"),Q=n(q,"superpowers-agent.js");if(console.log("Installing OpenCode plugin symlink..."),!_$($))return console.log("⚠️  Source plugin not found, skipping symlink creation"),console.log(`   Expected at: ${$}`),{created:!1,error:"Source plugin not found"};if(cQ(Q,$))return console.log("✓ Plugin symlink already exists and is correct"),{created:!1,existed:!0};if(_$(Q)&&!a$(Q))return console.log("⚠️  Warning: A file already exists at the destination path"),console.log(`   Path: ${Q}`),console.log("   Skipping symlink creation to avoid overwriting existing file"),console.log("   To use superpowers-agent plugin, manually remove or rename the existing file"),{created:!1,error:"File already exists at destination"};if(!_$(q))try{hQ(q,{recursive:!0}),console.log(`✓ Created ${q.replace(H.home,"~")}`)}catch(X){return console.log(`⚠️  Failed to create plugins directory: ${X.message}`),{created:!1,error:`Failed to create directory: ${X.message}`}}if(a$(Q))try{dQ(Q)}catch(X){return console.log(`⚠️  Failed to remove existing symlink: ${X.message}`),{created:!1,error:`Failed to remove existing symlink: ${X.message}`}}let Y=pQ();try{if(Y==="win32")uq($,Q,"file");else uq($,Q);let X=$.replace(H.home,"~"),Z=Q.replace(H.home,"~");return console.log(`✓ Created symlink: ${Z}`),console.log(`  -> ${X}`),{created:!0}}catch(X){if(Y==="win32"&&X.code==="EPERM")return console.log("⚠️  Windows requires Developer Mode or admin privileges for symlinks"),console.log("   Enable Developer Mode: Settings > Update & Security > For developers"),{created:!1,error:"Windows symlink permission denied"};return console.log(`⚠️  Failed to create symlink: ${X.message}`),{created:!1,error:`Failed to create symlink: ${X.message}`}}};import{existsSync as T,readdirSync as nQ,lstatSync as lQ,symlinkSync as hq,unlinkSync as aQ,mkdirSync as U$,readlinkSync as oQ}from"fs";import{join as _,dirname as iQ}from"path";import{homedir as N,platform as rQ}from"os";var mq=[{name:"claude",parentDir:()=>_(N(),".claude"),skillsDir:()=>_(N(),".claude","skills"),superpowersTarget:"superpowers"},{name:"copilot",parentDir:()=>_(N(),".copilot"),skillsDir:()=>_(N(),".copilot","skills"),superpowersTarget:"superpowers"},{name:"opencode",parentDir:()=>_(N(),".config","opencode"),skillsDir:()=>_(N(),".config","opencode","skill"),superpowersTarget:"superpowers"},{name:"cursor",parentDir:()=>_(N(),".cursor"),skillsDir:()=>_(N(),".cursor","skills"),superpowersTarget:"superpowers"},{name:"gemini",parentDir:()=>_(N(),".gemini"),skillsDir:()=>_(N(),".gemini","skills"),superpowersTarget:"superpowers"},{name:"codex",parentDir:()=>_(N(),".codex"),skillsDir:()=>_(N(),".codex","skills"),superpowersTarget:"superpowers"}],sQ=[{name:"claude",agentDir:($)=>_($,".claude"),skillsDir:($)=>_($,".claude","skills"),detect:($)=>T(_($,".claude"))},{name:"copilot",agentDir:($)=>_($,".github"),skillsDir:($)=>_($,".github","skills"),detect:($)=>{let q=T(_($,".github")),Q=T(_($,"AGENTS.md"))||T(_($,".agents","AGENTS.md"));return q&&Q}},{name:"opencode",agentDir:($)=>_($,".opencode"),skillsDir:($)=>_($,".opencode","skill"),detect:($)=>{let q=T(_($,".opencode")),Q=T(_($,"AGENTS.md"))||T(_($,".agents","AGENTS.md"))||T(_($,".opencode","AGENTS.md"));return q&&Q}},{name:"cursor",agentDir:($)=>_($,".cursor"),skillsDir:($)=>_($,".cursor","skills"),detect:($)=>T(_($,".cursor"))},{name:"gemini",agentDir:($)=>_($,".gemini"),skillsDir:($)=>_($,".gemini","skills"),detect:($)=>{let q=T(_($,".gemini")),Q=T(_($,"GEMINI.md"))||T(_($,".agents","GEMINI.md"));return q&&Q}},{name:"codex",agentDir:($)=>_($,".codex"),skillsDir:($)=>_($,".codex","skills"),detect:($)=>{let q=T(_($,".codex")),Q=T(_($,"AGENTS.md"))||T(_($,".agents","AGENTS.md"));return q&&Q}}],o$=($)=>{try{return lQ($).isSymbolicLink()}catch{return!1}},tQ=($,q)=>{try{if(!o$($))return!1;return oQ($)===q}catch{return!1}},v$=($,q)=>{if(!T($))return{created:!1,existed:!1,error:`Source does not exist: ${$}`};if(tQ(q,$))return{created:!1,existed:!0};if(T(q)||o$(q))if(o$(q))try{aQ(q)}catch(X){return{created:!1,existed:!1,error:`Failed to remove existing symlink: ${X.message}`}}else return{created:!1,existed:!1,error:`Target exists and is not a symlink: ${q}`};let Q=iQ(q);if(!T(Q))try{U$(Q,{recursive:!0})}catch(X){return{created:!1,existed:!1,error:`Failed to create parent directory: ${X.message}`}}let Y=rQ();try{if(Y==="win32")hq($,q,"junction");else hq($,q,"dir");return{created:!0,existed:!1}}catch(X){if(Y==="win32"&&X.code==="EPERM")return{created:!1,existed:!1,error:"Windows requires Developer Mode or admin privileges for symlinks. Enable Developer Mode: Settings > Update & Security > For developers"};return{created:!1,existed:!1,error:`Failed to create symlink: ${X.message}`}}};var pq=($,q,Q="skills")=>{let Y=p(!0);if(!Y.symlinks)Y.symlinks={};if(!Y.symlinks[$])Y.symlinks[$]={superpowers:null,skills:[]};if(Q==="superpowers")Y.symlinks[$].superpowers=q;else{let X=Y.symlinks[$].skills||[];if(!X.includes(q))X.push(q),Y.symlinks[$].skills=X}o(Y,!0)};var eQ=($,q={})=>{let Q=H.homeSuperpowersSkills,Y=_($.skillsDir(),$.superpowersTarget),X=v$(Q,Y);if(X.created){pq($.name,Y,"superpowers");let Z=Q.replace(N(),"~"),W=Y.replace(N(),"~");return console.log(`  ✓ Created ${W} -> ${Z}`),{created:!0}}else if(X.existed)return{created:!1,existed:!0};else if(X.error)return console.log(`  ⚠️  ${$.name} superpowers: ${X.error}`),{created:!1,error:X.error};return{created:!1}},cq=($,q={})=>{let Q=H.homePersonalSkills;if(!T(Q))return{created:0,existed:0};let Y;try{Y=nQ(Q,{withFileTypes:!0}).filter((Z)=>Z.isDirectory()&&!Z.name.startsWith(".")).map((Z)=>Z.name)}catch{return{created:0,existed:0}}if(Y.length===0)return{created:0,existed:0};let X={created:0,existed:0,names:[]};for(let Z of Y){let W=_(Q,Z),E=_($.skillsDir(),Z),V=v$(W,E);if(V.created)pq($.name,E,"skills"),X.created++,X.names.push(Z);else if(V.existed)X.existed++;else if(V.error)console.log(`  ⚠️  ${Z}: ${V.error}`)}if(X.created>0)console.log(`  ✓ Synced ${X.created} personal skill(s): ${X.names.join(", ")}`);return X},x$=($={})=>{let{force:q=!1}=$;for(let Q of mq){let Y=Q.parentDir(),X=Q.skillsDir();if(!T(Y))if(q)try{U$(Y,{recursive:!0}),console.log(`✓ Created ${Y.replace(N(),"~")}`)}catch(Z){console.log(`⚠️  Failed to create ${Y.replace(N(),"~")}: ${Z.message}`);continue}else{console.log(`⚠️  Skipping ${Q.name} (${Y.replace(N(),"~")} not found)`),console.log("   Use --force to create directory");continue}if(!T(X))try{U$(X,{recursive:!0})}catch(Z){console.log(`⚠️  Failed to create skills directory for ${Q.name}: ${Z.message}`);continue}console.log(`${Q.name}:`),eQ(Q,$),cq(Q,$)}},i$=($={})=>{let{force:q=!1}=$;for(let Q of mq){let Y=Q.parentDir(),X=Q.skillsDir();if(!T(Y)){if(!q)continue;try{U$(Y,{recursive:!0})}catch{continue}}if(!T(X))try{U$(X,{recursive:!0})}catch{continue}cq(Q,$)}};var nq=($={})=>{let q=$.projectRoot||process.cwd(),Q=_(q,".agents","skills");if(!T(Q))return{created:0,existed:0,skipped:0,errors:[]};let Y={created:0,existed:0,skipped:0,errors:[]};for(let X of sQ){if(!X.detect(q)){Y.skipped++;continue}let Z=X.skillsDir(q),W=X.agentDir(q);if(!T(W)){Y.skipped++;continue}let E=v$(Q,Z);if(E.created){let V=Z.replace(q,".");console.log(`  ✓ Created ${V} -> .agents/skills`),Y.created++}else if(E.existed)Y.existed++;else if(E.error)console.log(`  ⚠️  ${X.name}: ${E.error}`),Y.errors.push({platform:X.name,error:E.error})}return Y};var qX=($)=>{let Q={"copilot-prompts":r,"cursor-commands":t,"cursor-hooks":e,"codex-prompts":$$,"gemini-commands":q$,"claude-commands":Q$,"opencode-commands":X$,"opencode-plugin":L$}[$];if(Q)try{return Q(),{success:!0,integration:$}}catch(Y){return{success:!1,integration:$,error:Y.message}}return{success:!1,integration:$,error:"Unknown integration"}},QX=()=>{console.log("Installing aliases...")},D$=($={})=>{let q=$.skipReinstall||!1;console.log(`# Checking for Superpowers updates...
`);let Q=b$();if(Q.error){console.log("⚠️  Could not check for updates (network issue)");return}if(!Q.hasUpdates){console.log("✓ Already up to date");return}if(Q.hasLocalChanges){console.log(`⚠️  Cannot auto-update: local changes detected
   Commit or stash your changes first, then run update again
   Or manually update: cd ${H.superpowersRepo} && git pull`);return}if(!G$()){console.log(`⚠️  Not on main branch, skipping auto-update
   Switch to main branch first: cd ${H.superpowersRepo} && git checkout main`);return}console.log(`\uD83D\uDCE6 Updating from ${Q.currentCommit.substring(0,7)} to ${Q.latestCommit.substring(0,7)}
   (${Q.commitsBehind} new commit${Q.commitsBehind>1?"s":""})
`);try{$X("git pull origin main",{cwd:H.superpowersRepo,stdio:"pipe",timeout:1e4}),console.log("✓ Updated superpowers repository")}catch(W){console.log(`✗ Git pull failed: ${W.message}
   Please resolve manually and try again`);return}if(console.log(""),T$({last_updated_commit:Q.latestCommit,last_update_check:new Date().toISOString()}),q){console.log(`ℹ️  Skipping integration reinstall (--no-reinstall flag)

✓ Update complete!`);return}let Y=Rq(Q.changedFiles);if(Y.length===0){console.log(`ℹ️  No integration files changed, skipping reinstalls

✓ Update complete!`);return}console.log(`\uD83D\uDD04 Reinstalling updated integrations:
`);let X=[];for(let W of Y){let E=qX(W);if(X.push(E),E.success)console.log(`  ✓ ${W}`);else console.log(`  ✗ ${W} (${E.error})`)}console.log(""),console.log(`
---
`),QX(),console.log(`
---
`),console.log(`## Syncing Skill Symlinks
`),x$(),console.log(`
---
`),console.log(`## OpenCode Plugin Symlink
`),L$();let Z=X.filter((W)=>!W.success);if(Z.length>0){console.log("⚠️  Update completed with errors:");for(let W of Z){console.log(`  - ${W.integration} failed to install`);let E=`install-${W.integration}`;console.log(`    Run manually: superpowers-agent ${E}`)}}else console.log("✓ Update complete!")},lq=async()=>{x();let $=k();console.log(`Current version: ${$}`);try{let q=await Oq();if(console.log(`Latest version: ${q}`),Iq(q,$))console.log("Update available: Yes"),process.exit(1);else console.log("You are up to date"),process.exit(0)}catch(q){console.log(`Error checking for updates: ${q.message}`),process.exit(1)}},aq=()=>{let $=k();console.log($)};import{existsSync as v,readFileSync as u,writeFileSync as Z$}from"fs";import{join as A,dirname as iq,parse as Y$}from"path";import{execSync as C}from"child_process";import{platform as YX}from"os";import{execSync as XX}from"child_process";var O$=($)=>{try{return XX(`which ${$}`,{stdio:"pipe",timeout:2000}),!0}catch{return!1}};var J={opencode:{check:()=>O$("opencode"),cli:!0,name:"OpenCode",installUrl:"https://opencode.ai/docs/installation",bootstrapCommand:"install-opencode-commands"},claude:{check:()=>O$("claude"),cli:!0,name:"Claude Code",installUrl:"https://code.claude.com/docs/en/installation",bootstrapCommand:"install-claude-commands"},gemini:{check:()=>O$("gemini"),cli:!0,name:"Gemini",installUrl:"https://cloud.google.com/gemini/docs/cli/install",bootstrapCommand:"install-gemini-commands"},codex:{check:()=>O$("codex"),cli:!0,name:"Codex",installUrl:"https://developers.openai.com/codex/docs/installation",bootstrapCommand:"install-codex-prompts"},cursor:{check:()=>!0,cli:!1,name:"Cursor",bootstrapCommand:"install-cursor-commands"},copilot:{check:()=>!0,cli:!1,name:"GitHub Copilot",bootstrapCommand:"install-copilot-prompts"}},oq=()=>{let $=[];if(J.copilot.check())$.push("github-copilot");if(J.cursor.check())$.push("cursor");if(J.claude.check())$.push("claude-code");if(J.opencode.check())$.push("opencode");if(J.gemini.check())$.push("gemini");if(J.codex.check())$.push("codex");return $};var ZX=()=>{let $=A(H.superpowersRepo,".agents","templates","TOOLS.md.template");if(v($))try{return u($,"utf8").trim()}catch(q){return"### Using Tools\n\nUse your native skill tool. Fallback: `superpowers-agent find-skills`"}return""},I$=($,q,Q,Y=!0)=>{let X=v($);if(!X&&!Y)return{updated:!1,created:!1,skipped:!0};let Z=ZX(),W=q.replace(/\{\{TOOL_MAPPINGS\}\}/g,Z),E=new Date().toISOString().split("T")[0];W=W.replace(/\{\{DATE\}\}/g,E),W=W.replace(/\{\{SUPERPOWERS_PATH\}\}/g,H.superpowersRepo);let V=`<!-- SUPERPOWERS_SKILLS_START -->
${W}
<!-- SUPERPOWERS_SKILLS_END -->`;if(X){let z=new Date().toISOString().split("T")[0],K=`${$}.backup-${z}`;try{C(`cp "${$}" "${K}"`,{stdio:"pipe"})}catch(O){return{updated:!1,error:!0,message:`Failed to backup: ${O.message}`}}let G;try{G=u($,"utf8")}catch(O){return{updated:!1,error:!0,message:`Failed to read: ${O.message}`}}let L="<!-- SUPERPOWERS_SKILLS_START -->",B="<!-- SUPERPOWERS_SKILLS_END -->",U;if(G.includes(L)&&G.includes(B)){let O=new RegExp(`${L}[\\s\\S]*?${B}`,"g");U=G.replace(O,V)}else{let O=G.match(/^#\s+.+$/m);if(O){let M=G.indexOf(`
`,O.index)+1;U=G.slice(0,M)+`
`+V+`
`+G.slice(M)}else U=V+`

`+G}try{return Z$($,U,"utf8"),{updated:!0,created:!1,backup:K}}catch(O){return{updated:!1,error:!0,message:`Failed to write: ${O.message}`}}}else try{let z=iq($);if(!v(z))C(`mkdir -p "${z}"`,{stdio:"pipe"});let L=`# ${Y$($).base.toUpperCase()}

`+V;return Z$($,L,"utf8"),{updated:!1,created:!0}}catch(z){return{updated:!1,created:!1,error:!0,message:`Failed to create: ${z.message}`}}},HX=()=>{console.log("Installing Unix aliases...");let $=A(H.superpowersRepo,".agents","superpowers-agent"),q=A(H.home,".local","bin"),Q=A(q,"superpowers-agent"),Y=A(q,"superpowers");if(!v($)){console.log("⚠️  superpowers-agent executable not found");return}if(!v(q))try{C(`mkdir -p "${q}"`,{stdio:"pipe"}),console.log(`✓ Created ${q}`)}catch(Z){console.log(`⚠️  Failed to create ${q}: ${Z.message}`);return}try{if(v(Q))C(`rm "${Q}"`,{stdio:"pipe"});C(`ln -s "${$}" "${Q}"`,{stdio:"pipe"}),console.log(`✓ Created symlink: superpowers-agent -> ${$}`)}catch(Z){console.log(`⚠️  Failed to create superpowers-agent symlink: ${Z.message}`)}try{if(v(Y))C(`rm "${Y}"`,{stdio:"pipe"});C(`ln -s "${$}" "${Y}"`,{stdio:"pipe"}),console.log(`✓ Created symlink: superpowers -> ${$}`)}catch(Z){console.log(`⚠️  Failed to create superpowers symlink: ${Z.message}`)}if(!(process.env.PATH||"").includes(q))console.log(`
⚠️  Warning: ${q} is not in your PATH`),console.log("   Add this to your shell profile (~/.bashrc, ~/.zshrc, etc.):"),console.log(`   export PATH="$HOME/.local/bin:$PATH"
`)},WX=()=>{console.log("Installing Windows aliases..."),console.log("✓ Windows alias installation (implementation pending)")},r$=()=>{let $=YX();if(console.log(`## Installing Universal Aliases
`),$==="win32")return WX();else return HX()},EX=($)=>{let q=A(H.superpowersRepo,".github","copilot-instructions.md"),Q=A(H.superpowersRepo,"skills","meta","using-superpowers","SKILL.md"),Y=A($,".github","copilot-instructions.md"),X="<!-- SUPERPOWERS_-_INSTRUCTIONS_START -->",Z="<!-- SUPERPOWERS_-_INSTRUCTIONS_END -->";if(!v(q))return{error:!0,message:"Source template not found"};if(!v(Q))return{error:!0,message:"using-superpowers SKILL.md not found"};let W,E;try{W=u(q,"utf8"),E=u(Q,"utf8")}catch(K){return{error:!0,message:`Failed to read source files: ${K.message}`}}let V=W.replace("${content}",E);if(!V.includes("<!-- SUPERPOWERS_-_INSTRUCTIONS_START -->")||!V.includes("<!-- SUPERPOWERS_-_INSTRUCTIONS_END -->"))return{error:!0,message:"Template is missing required markers"};let z=iq(Y);try{if(!v(z))C(`mkdir -p "${z}"`,{stdio:"pipe"})}catch(K){return{error:!0,message:`Failed to create .github directory: ${K.message}`}}if(v(Y)){let K;try{K=u(Y,"utf8")}catch(B){return{error:!0,message:`Failed to read existing file: ${B.message}`}}let G=new Date().toISOString().replace(/[:.]/g,"-"),L=`${Y}.backup-${G}`;try{C(`cp "${Y}" "${L}"`,{stdio:"pipe"})}catch(B){return{error:!0,message:`Failed to backup: ${B.message}`}}if(K.includes("<!-- SUPERPOWERS_-_INSTRUCTIONS_START -->")&&K.includes("<!-- SUPERPOWERS_-_INSTRUCTIONS_END -->")){let B=new RegExp("<!-- SUPERPOWERS_-_INSTRUCTIONS_START -->[\\s\\S]*?<!-- SUPERPOWERS_-_INSTRUCTIONS_END -->","g"),U=K.replace(B,V.trim());try{return Z$(Y,U,"utf8"),{updated:!0,backup:L}}catch(O){return{error:!0,message:`Failed to update: ${O.message}`}}}else{let B=K.trimEnd()+`

`+V.trim()+`
`;try{return Z$(Y,B,"utf8"),{updated:!0,backup:L}}catch(U){return{error:!0,message:`Failed to append: ${U.message}`}}}}else try{return Z$(Y,V,"utf8"),{created:!0}}catch(K){return{error:!0,message:`Failed to create: ${K.message}`}}},rq=()=>{x(),console.log(`# Setting up Superpowers skills for this project
`);let $=process.cwd(),q=A($,".agents"),Q=A(q,"skills"),Y=A($,"AGENTS.md"),X=A(q,"AGENTS.md"),Z=v(Y)?Y:X,W=A(H.superpowersRepo,".agents","templates","AGENTS.md.template");if(!v(W)){console.log(`✗ Error: AGENTS.md template not found
  Expected at: ${W}
  Please update your Superpowers installation`);return}if(!v(q))try{C(`mkdir -p "${q}"`,{stdio:"pipe"}),console.log("✓ Created .agents/ directory")}catch(I){console.log(`✗ Failed to create .agents/ directory: ${I.message}`);return}else console.log("✓ .agents/ directory exists");if(!v(Q))try{C(`mkdir -p "${Q}"`,{stdio:"pipe"}),C(`touch "${A(Q,".gitkeep")}"`,{stdio:"pipe"}),console.log("✓ Created .agents/skills/ directory")}catch(I){console.log(`✗ Failed to create skills directory: ${I.message}`);return}else console.log("✓ .agents/skills/ directory exists");let E=A(q,"docs"),V=A(E,"SUPERPOWERS.md"),z=A(H.superpowersRepo,".agents","templates","SUPERPOWERS.md.template");if(!v(E))try{C(`mkdir -p "${E}"`,{stdio:"pipe"}),console.log("✓ Created .agents/docs/ directory")}catch(I){console.log(`⚠️  Failed to create docs directory: ${I.message}`)}else console.log("✓ .agents/docs/ directory exists");let K=v(Z);if(K){let I=new Date().toISOString().split("T")[0],w$=`${Z}.backup-${I}`;try{C(`cp "${Z}" "${w$}"`,{stdio:"pipe"}),console.log(`✓ Backed up existing AGENTS.md to ${Y$(w$).base}`)}catch(BQ){console.log(`✗ Failed to backup AGENTS.md: ${BQ.message}`);return}}let G;try{G=u(W,"utf8")}catch(I){console.log(`✗ Failed to read template: ${I.message}`);return}let L=k();if(G=G.replace(/\{\{VERSION\}\}/g,L),v(z))try{let I=u(z,"utf8"),w$=new Date().toISOString().split("T")[0];I=I.replace(/\{\{VERSION\}\}/g,L),I=I.replace(/\{\{DATE\}\}/g,w$),Z$(V,I,"utf8"),console.log("✓ Created .agents/docs/SUPERPOWERS.md")}catch(I){console.log(`⚠️  Failed to create SUPERPOWERS.md: ${I.message}`)}else console.log("⚠️  SUPERPOWERS.md.template not found");let B=[],U=A($,".github","copilot-instructions.md"),O=A(H.home,".github","copilot-instructions.md");if(v(U)||v(O)||J.copilot.check())B.push("github-copilot");let M=A($,"CLAUDE.md"),d=A(q,"CLAUDE.md");if(v(M)||v(d)||J.claude.check())B.push("claude-code");let P=A($,"GEMINI.md"),qq=A(q,"GEMINI.md");if(v(P)||v(qq)||J.gemini.check())B.push("gemini");if(J.cursor.check())B.push("cursor");if(J.opencode.check())B.push("opencode");if(J.codex.check())B.push("codex");console.log(`
Detected platforms for project: ${B.join(", ")||"none"}
`);let KQ=B.filter((I)=>["github-copilot","cursor","opencode","codex"].includes(I)),H$=I$(Z,G,KQ,!K);if(H$.created)console.log(`✓ Created AGENTS.md with platform tool mappings (${Z===Y?"root":".agents/"})`);else if(H$.updated)console.log(`✓ Updated AGENTS.md with platform tool mappings (${Z===Y?"root":".agents/"})`);else if(H$.error)console.log("⚠️  Failed to update AGENTS.md");let k$=v(M)?M:d,f=I$(k$,G,["claude-code"],!1);if(f.created)console.log(`✓ Created CLAUDE.md with Claude Code tool mappings (${k$===M?"root":".agents/"})`);else if(f.updated){if(console.log(`✓ Updated CLAUDE.md with Claude Code tool mappings (${k$===M?"root":".agents/"})`),f.backup)console.log(`  Backed up to ${Y$(f.backup).base}`)}else if(f.skipped)console.log("ℹ️  Skipped CLAUDE.md (does not exist)");else if(f.error)console.log("⚠️  Failed to update CLAUDE.md");let u$=v(P)?P:qq,S=I$(u$,G,["gemini"],!1);if(S.created)console.log(`✓ Created GEMINI.md with Gemini tool mappings (${u$===P?"root":".agents/"})`);else if(S.updated){if(console.log(`✓ Updated GEMINI.md with Gemini tool mappings (${u$===P?"root":".agents/"})`),S.backup)console.log(`  Backed up to ${Y$(S.backup).base}`)}else if(S.skipped)console.log("ℹ️  Skipped GEMINI.md (does not exist)");else if(S.error)console.log("⚠️  Failed to update GEMINI.md");let J$=A($,".github","copilot-instructions.md"),j={skipped:!0};if(B.includes("github-copilot")){if(j=EX($),j.created)console.log("✓ Created .github/copilot-instructions.md with Superpowers instructions");else if(j.updated){if(console.log("✓ Updated .github/copilot-instructions.md with Superpowers instructions"),j.backup)console.log(`  Backed up to ${Y$(j.backup).base}`)}else if(j.error)console.log(`⚠️  Failed to update .github/copilot-instructions.md: ${j.message||""}`)}else console.log("ℹ️  Skipped .github/copilot-instructions.md (GitHub Copilot not detected)");let Qq=!v(Y)&&!v(X);if(v(J$)&&Qq){let I=I$(J$,G,["github-copilot"],!1);if(I.updated){if(console.log("✓ Updated .github/copilot-instructions.md with GitHub Copilot tool mappings"),I.backup)console.log(`  Backed up to ${Y$(I.backup).base}`)}else if(I.error)console.log("⚠️  Failed to update .github/copilot-instructions.md with tool mappings")}else if(v(J$)&&!Qq)console.log("ℹ️  Skipped .github/copilot-instructions.md tool mappings (AGENTS.md exists, using that instead)");else if(!v(J$)&&!B.includes("github-copilot"))console.log("ℹ️  Skipped .github/copilot-instructions.md tool mappings (does not exist)");console.log(`
## Syncing Project Skill Symlinks
`);let a=nq({projectRoot:$});if(a.created>0)console.log(`
✓ Created ${a.created} project skill symlink(s)`);else if(a.existed>0)console.log("ℹ️  Project skill symlinks already exist");else if(a.errors.length>0)console.log("⚠️  Some symlinks could not be created");else console.log("ℹ️  No agent directories detected for symlinking");let y=`
# Setup complete!

Your project now has:
  - .agents/ directory structure`;if(H$.updated||H$.created)y+=`
  - AGENTS.md with universal skills instructions`;if(f.updated||f.created)y+=`
  - CLAUDE.md with Claude Code skills instructions`;if(S.updated||S.created)y+=`
  - GEMINI.md with Gemini skills instructions`;if(j.updated||j.created)y+=`
  - .github/copilot-instructions.md with Superpowers instructions`;if(a.created>0)y+=`
  - ${a.created} project skill symlink(s) to agent directories`;y+=`
  - .agents/skills/ ready for project-specific skills`,y+=`
  - .agents/docs/SUPERPOWERS.md for detailed reference
`,console.log(y)},sq=()=>{if(x(),console.log(`# Superpowers Bootstrap for Agents
# ==================================
`),!process.argv.includes("--no-update")){let z=V$(),K=b$();if(K.error)console.log(`## Update Check

⚠️  Could not check for updates (network issue)

---
`);else if(K.hasUpdates)if(z.auto_update&&!K.hasLocalChanges&&G$())console.log(`## Auto-Update
`),D$(),console.log(`
---
`);else{if(console.log(`## Update Available
`),K.hasLocalChanges)console.log("⚠️  Your superpowers installation is behind the latest version.\n    Cannot auto-update: local changes detected\n    To update, commit/stash changes then run: `superpowers-agent update`");else if(!G$())console.log("⚠️  Your superpowers installation is behind the latest version.\n    Cannot auto-update: not on main branch\n    To update, switch to main then run: `superpowers-agent update`");else console.log("⚠️  Your superpowers installation is behind the latest version.\n    To update, run: `superpowers-agent update`\n    Or enable auto-update: `superpowers-agent config-set auto_update true`");console.log(`
---
`)}}if(r$(),console.log(`---
`),console.log(`## GitHub Copilot Integration
`),r(),console.log(`
---
`),console.log(`## Cursor Integration
`),t(),console.log(""),e(),console.log(`
---
`),console.log(`## OpenAI Codex Integration
`),J.codex.check())$$();else console.log(`⚠️  Skipped (${J.codex.name} CLI not detected)
\uD83D\uDCA1 To enable Codex integration:
   1. Install Codex: ${J.codex.installUrl}
   2. Run: superpowers-agent ${J.codex.bootstrapCommand}`);if(console.log(`
---
`),console.log(`## Gemini Integration
`),J.gemini.check())q$();else console.log(`⚠️  Skipped (${J.gemini.name} CLI not detected)
\uD83D\uDCA1 To enable Gemini integration:
   1. Install Gemini: ${J.gemini.installUrl}
   2. Run: superpowers-agent ${J.gemini.bootstrapCommand}`);if(console.log(`
---
`),console.log(`## Claude Code Integration
`),J.claude.check())Q$();else console.log(`⚠️  Skipped (${J.claude.name} CLI not detected)
\uD83D\uDCA1 To enable Claude Code integration:
   1. Install Claude Code: ${J.claude.installUrl}
   2. Run: superpowers-agent ${J.claude.bootstrapCommand}`);if(console.log(`
---
`),console.log(`## OpenCode Integration
`),J.opencode.check())X$(),console.log(""),L$();else console.log(`⚠️  Skipped (${J.opencode.name} CLI not detected)
\uD83D\uDCA1 To enable OpenCode integration:
   1. Install OpenCode: ${J.opencode.installUrl}
   2. Run: superpowers-agent ${J.opencode.bootstrapCommand}`);console.log(`
---
`),console.log(`## Generating Platform-Specific Files
`);let Z=oq();console.log(`Detected platforms: ${Z.join(", ")||"none"}
`);let W=A(H.superpowersRepo,".agents","templates","AGENTS.md.template"),E="";try{E=u(W,"utf8")}catch(z){console.log(`⚠️  Could not read AGENTS.md template: ${z.message}
`)}if(E){let z=k();E=E.replace(/\{\{VERSION\}\}/g,z);let K=A(H.home,".agents","AGENTS.md"),G=I$(K,E,Z,!0);if(G.created)console.log(`✓ Created ${K}`);else if(G.updated)console.log(`✓ Updated ${K}`)}console.log(`
---
`),console.log(`## Syncing Skill Symlinks
`);let V=process.argv.includes("--force");x$({force:V}),console.log(`
---
`),console.log(`# Bootstrap Complete!
`),console.log("✓ All integrations installed"),console.log("✓ Skills system ready"),console.log(`✓ Skill symlinks synced
`),console.log("Next steps:"),console.log("  - Run `superpowers-agent find-skills` to see available skills"),console.log("  - Run `superpowers-agent setup-skills` in your project directory")};import{existsSync as R,readFileSync as S$,mkdirSync as OX,rmSync as IX,cpSync as JX}from"fs";import{join as b,dirname as y$,parse as P$,sep as wX}from"path";import{execSync as F}from"child_process";import{homedir as l}from"os";import{readFileSync as KX,existsSync as e$,unlinkSync as BX,lstatSync as VX,mkdirSync as GX}from"fs";import{join as _X,dirname as LX}from"path";import{join as j$}from"path";import{homedir as zX}from"os";var s$={github:{name:"github",sourceDir:".github/agents",sourceExt:".agent.md",getDestDir:()=>j$(H.vscodeUserDir,"prompts"),destExt:".agent.md"},opencode:{name:"opencode",sourceDir:".opencode/agents",sourceExt:".md",getDestDir:()=>j$(zX(),".config","opencode","agents"),destExt:".md"}};function tq($,q,Q){let Y=s$[q];if(!Y)return null;return j$($,Y.sourceDir,`${Q}${Y.sourceExt}`)}function eq($,q){let Q=s$[$];if(!Q)return null;return j$(Q.getDestDir(),`${q}${Q.destExt}`)}function t$(){return Object.keys(s$)}function UX($){if(!$||typeof $!=="object")return{valid:!1,error:"agents.json must be a JSON object"};if(!$.version||typeof $.version!=="string")return{valid:!1,error:'agents.json must have a "version" string field'};if(!$.agents||typeof $.agents!=="object")return{valid:!1,error:'agents.json must have an "agents" object field'};let q=t$(),Q=[];for(let[Y,X]of Object.entries($.agents)){if(!q.includes(Y)){Q.push(Y);continue}if(!Array.isArray(X))return{valid:!1,error:`agents.${Y} must be an array of agent names`};for(let Z of X)if(typeof Z!=="string")return{valid:!1,error:`agents.${Y} must contain only string agent names`}}return{valid:!0,data:$,skippedPlatforms:Q}}function vX($,q){if(!e$($))return{installed:!1,error:`Source file not found: ${$}`};if(e$(q))try{if(!VX(q).isSymbolicLink())BX(q)}catch(Y){}GX(LX(q),{recursive:!0});let Q=v$($,q);if(Q.error)return{installed:!1,error:Q.error};return{installed:!0}}function $q($,q={}){let Q=_X($,"agents.json");if(!e$(Q))return;let Y;try{Y=JSON.parse(KX(Q,"utf8"))}catch(B){console.log(`
  ⚠ Could not parse agents.json: ${B.message}`);return}let X=UX(Y);if(!X.valid){console.log(`
  ⚠ Invalid agents.json: ${X.error}`);return}for(let B of X.skippedPlatforms)console.log(`  ⚠ Skipping unknown platform: ${B}`);let Z=Y.repository||"unknown",W=Y.version,E=q.isUpdate?"Updating":"Installing",V=q.isUpdate?"Updated":"Installed";console.log(`
  \uD83D\uDCE6 Found agents.json (${Z} v${W})`);let z=t$(),K=0,G=0,L=[];for(let[B,U]of Object.entries(Y.agents)){if(!z.includes(B))continue;console.log(`
  ${E} ${B} agents:`);for(let O of U){let M=tq($,B,O),d=eq(B,O),P=vX(M,d);if(P.installed)console.log(`    ✓ ${O}`),L.push({platformKey:B,agentName:O,sourcePath:M,destPath:d}),K++;else console.log(`    ✗ ${O}: ${P.error}`),G++}}if(L.length>0){let B=p(!0);if(!B.installedAgents)B.installedAgents={};if(!B.installedAgents[Z])B.installedAgents[Z]={version:W,agents:{}};B.installedAgents[Z].version=W;for(let{platformKey:U,agentName:O,sourcePath:M,destPath:d}of L){if(!B.installedAgents[Z].agents[U])B.installedAgents[Z].agents[U]={};B.installedAgents[Z].agents[U][O]={source:M,destination:d,installedAt:new Date().toISOString()}}o(B,!0)}if(K>0)console.log(`
  ${V} ${K} agent(s)${G>0?` (${G} failed)`:""}`)}var $Q=($,q)=>{if(q.type==="local"){let Y=$;for(let X=0;X<10;X++){if(R(b(Y,"agents.json")))return Y;let Z=y$(Y);if(Z===Y)break;Y=Z}return $}let Q=b(".agents","tmp");if($.includes(Q)){let Y=$.indexOf(Q),Z=$.substring(Y+Q.length+1).split(wX)[0];return b($.substring(0,Y),".agents","tmp",Z)}return $},qQ=($,q)=>{let Q=b(l(),".agents","repos"),Y=q.replace(/^@/,"").replace(/[^a-zA-Z0-9_-]/g,"_"),X=b(Q,Y);try{if(OX(Q,{recursive:!0}),R(X))IX(X,{recursive:!0,force:!0});return JX($,X,{recursive:!0}),X}catch(Z){return console.log(`  Warning: Could not persist repository for agents: ${Z.message}`),null}},QQ=($)=>{let q=$.match(/^https:\/\/github\.com\/([^/]+)\/([^/]+)\/tree\/([^/]+)\/(.+)$/);if(q){let[,X,Z,W,E]=q;return{type:"git-tree",repoUrl:`https://github.com/${X}/${Z}.git`,branch:W,path:E,original:$}}let Q=$.match(/^git@github\.com:([^/]+)\/([^/]+?)(?:\.git)?$/);if(Q){let[,X,Z]=Q;return{type:"git-repo",repoUrl:`git@github.com:${X}/${Z}.git`,branch:null,path:null,original:$}}let Y=$.match(/^https:\/\/github\.com\/([^/]+)\/([^/]+)(?:\.git)?$/);if(Y){let[,X,Z]=Y;return{type:"git-repo",repoUrl:`https://github.com/${X}/${Z}.git`,branch:null,path:null,original:$}}if(R($))return{type:"local",path:$,original:$};return null},XQ=($)=>{let q=$.includes("--global")||$.includes("-g"),Q=$.includes("--project")||$.includes("-p");if(q)return b(l(),".agents","skills");if(Q)return b(process.cwd(),".agents","skills");let Y=b(process.cwd(),".agents","config.json"),X=b(l(),".agents","config.json");for(let Z of[Y,X])if(R(Z))try{if(JSON.parse(S$(Z,"utf8")).installLocation==="project")return b(process.cwd(),".agents","skills")}catch(W){}return b(l(),".agents","skills")},YQ=($,q)=>{let Q=b(l(),".agents","tmp",`skill-install-${Date.now()}`);try{if(F(`mkdir -p "${Q}"`,{stdio:"pipe"}),q)F(`git clone --branch ${q} --depth 1 "${$}" "${Q}"`,{stdio:"pipe",timeout:30000});else F(`git clone --depth 1 "${$}" "${Q}"`,{stdio:"pipe",timeout:30000});return Q}catch(Y){try{F(`rm -rf "${Q}"`,{stdio:"pipe"})}catch{}throw Error(`Failed to clone repository: ${Y.message}`)}},g$=($)=>{let q=b($,"skill.json");if(!R(q))return null;try{let Q=S$(q,"utf8");return JSON.parse(Q)}catch(Q){throw Error(`Failed to read skill.json: ${Q.message}`)}},f$=($,q,Q,Y)=>{let X=b($,q);if(!R(X)){Y.errors.push(`Skill directory not found: ${q}`);return}let Z=g$(X);if(!Z){Y.errors.push(`No skill.json found in: ${q}`);return}let W=Z.name||q,E=b(Q,W),V=y$(E);try{F(`mkdir -p "${V}"`,{stdio:"pipe"})}catch(z){Y.errors.push(`Failed to create directory ${V}: ${z.message}`);return}try{if(R(E))F(`rm -rf "${E}"`,{stdio:"pipe"});F(`cp -R "${X}" "${E}"`,{stdio:"pipe"}),Y.installed.push({name:W,path:E,title:Z.title||Z.description||W})}catch(z){Y.errors.push(`Failed to install ${q}: ${z.message}`)}},ZQ=()=>{let $=process.argv.slice(3),q=$.find((z)=>!z.startsWith("-")),Q=$.filter((z)=>z.startsWith("-"));if(!q){console.log(`Usage: superpowers-agent add <url-or-path|@alias> [skill-path] [options]

Options:
  --global, -g   Install skills globally in ~/.agents/skills/ (default)
  --project, -p  Install skills in current project's .agents/skills/

Examples:
  superpowers-agent add https://github.com/example/skills
  superpowers-agent add https://github.com/example/repo/tree/main/skills
  superpowers-agent add ~/my-local-skills
  superpowers-agent add https://github.com/example/skills --project
  superpowers-agent add ~/my-local-skills --global
  superpowers-agent add @myrepo path/to/skill
  superpowers-agent add @myrepo path/to/skills --project

Description:
  Installs skill(s) from a Git repository, local directory, or repository alias.
  Supports repositories with single or multiple skills.
  Reads skill.json to determine skill names and installation paths.
  
  Repository aliases can be added using:
    superpowers-agent add-repository <git-url> [--as=@alias]`);return}console.log(`Installing skill(s)...
`);let Y=null,X=null;if(q.startsWith("@")){let z=q;X=$.find((B,U)=>U>0&&!B.startsWith("-")&&B!==z);let K=g(!1),G=g(!0);if(K[z])Y=K[z],console.log(`Using project repository alias: ${z}`);else if(G[z])Y=G[z],console.log(`Using global repository alias: ${z}`);else{console.log(`Error: Repository alias not found: ${z}`),console.log(`
Available aliases:`);let B={...G,...K};if(Object.keys(B).length===0)console.log("  (none)"),console.log(`
Add a repository using:`),console.log("  superpowers-agent add-repository <git-url>");else for(let[U,O]of Object.entries(B))console.log(`  ${U} -> ${O}`);return}let L=R(Y);if(X)if(L)q=b(Y,X),console.log(`Repository path: ${Y}`),console.log(`Skill path: ${X}
`);else q=`${Y}/tree/main/${X}`,console.log(`Repository URL: ${Y}`),console.log(`Skill path: ${X}
`);else if(q=Y,L)console.log(`Repository path: ${Y}
`);else console.log(`Repository URL: ${Y}
`)}let Z=QQ(q);if(!Z){console.log(`Error: Invalid URL or path not found: ${q}`);return}let W=XQ(Q);console.log(`Install location: ${W}
`);let E,V=!1;try{if(Z.type==="git-repo"||Z.type==="git-tree"){if(console.log(`Cloning repository: ${Z.repoUrl}`),Z.branch)console.log(`Branch: ${Z.branch}`);if(E=YQ(Z.repoUrl,Z.branch),V=!0,Z.path){if(E=b(E,Z.path),!R(E))throw Error(`Path not found in repository: ${Z.path}`)}console.log("")}else E=Z.path;let z=g$(E);if(!z)throw Error("No skill.json found in source directory");let K={installed:[],errors:[],source:Z.original};if(z.skills&&Array.isArray(z.skills)){console.log(`Found ${z.skills.length} skill(s) to install
`);for(let B of z.skills)f$(E,B,W,K)}else{let B=z.name||P$(E).base;f$(y$(E),P$(E).base,W,K)}let G=$Q(E,Z),L=b(G,"agents.json");if(R(L)){let B=G;if(V){let U;try{U=JSON.parse(S$(L,"utf8"))}catch{}let O=U?.repository||Z.original,M=qQ(G,O);if(M)B=M}$q(B,{isUpdate:!1})}if(V&&E)try{let B=E.split("/.agents/tmp/")[0]+"/.agents/tmp/"+E.split("/.agents/tmp/")[1].split("/")[0];F(`rm -rf "${B}"`,{stdio:"pipe"})}catch{}if(console.log(`
**Successfully installed skills:**`),console.log(`- Source: ${K.source}`),K.installed.length>0)for(let B of K.installed)console.log(`  - Installed: ${B.name} at ${B.path}`),console.log(`    ${B.title}`);if(K.errors.length>0){console.log(`
**Errors:**`);for(let B of K.errors)console.log(`  - ${B}`)}if(K.installed.length===0&&K.errors.length===0)console.log("  No skills were installed");if(K.installed.length>0)console.log(`
**Syncing skill symlinks...**`),i$()}catch(z){if(V&&E)try{let K=E.split("/.agents/tmp/")[0]+"/.agents/tmp/"+E.split("/.agents/tmp/")[1].split("/")[0];F(`rm -rf "${K}"`,{stdio:"pipe"})}catch{}console.log(`
Error: ${z.message}`)}},HQ=()=>{let $=process.argv.slice(3),q=$.find((z)=>!z.startsWith("-")),Q=$.filter((z)=>z.startsWith("-"));if(!q){console.log(`Usage: superpowers-agent pull <url-or-path|@alias> [skill-path] [options]

Options:
  --global, -g   Update skills globally in ~/.agents/skills/ (default)
  --project, -p  Update skills in current project's .agents/skills/

Examples:
  superpowers-agent pull https://github.com/example/skills
  superpowers-agent pull https://github.com/example/repo/tree/main/skills
  superpowers-agent pull ~/my-local-skills
  superpowers-agent pull https://github.com/example/skills --project
  superpowers-agent pull ~/my-local-skills --global
  superpowers-agent pull @myrepo
  superpowers-agent pull @myrepo path/to/skill
  superpowers-agent pull @myrepo path/to/skills --project

Description:
  Updates or adds skill(s) from a Git repository, local directory, or repository alias.
  If skills already exist, they will be updated (replaced).
  If skills don't exist, they will be added.
  Supports repositories with single or multiple skills.
  Reads skill.json to determine skill names and installation paths.
  
  Repository aliases can be added using:
    superpowers-agent add-repository <git-url> [--as=@alias]`);return}console.log(`Updating skill(s)...
`);let Y=null,X=null;if(q.startsWith("@")){let z=q;X=$.find((B,U)=>U>0&&!B.startsWith("-")&&B!==z);let K=g(!1),G=g(!0);if(K[z])Y=K[z],console.log(`Using project repository alias: ${z}`);else if(G[z])Y=G[z],console.log(`Using global repository alias: ${z}`);else{console.log(`Error: Repository alias not found: ${z}`),console.log(`
Available aliases:`);let B={...G,...K};if(Object.keys(B).length===0)console.log("  (none)"),console.log(`
Add a repository using:`),console.log("  superpowers-agent add-repository <git-url>");else for(let[U,O]of Object.entries(B))console.log(`  ${U} -> ${O}`);return}let L=R(Y);if(X)if(L)q=b(Y,X),console.log(`Repository path: ${Y}`),console.log(`Skill path: ${X}
`);else q=`${Y}/tree/main/${X}`,console.log(`Repository URL: ${Y}`),console.log(`Skill path: ${X}
`);else if(q=Y,L)console.log(`Repository path: ${Y}
`);else console.log(`Repository URL: ${Y}
`)}let Z=QQ(q);if(!Z){console.log(`Error: Invalid URL or path not found: ${q}`);return}let W=XQ(Q);console.log(`Install location: ${W}
`);let E,V=!1;try{if(Z.type==="git-repo"||Z.type==="git-tree"){if(console.log(`Cloning repository: ${Z.repoUrl}`),Z.branch)console.log(`Branch: ${Z.branch}`);if(E=YQ(Z.repoUrl,Z.branch),V=!0,Z.path){if(E=b(E,Z.path),!R(E))throw Error(`Path not found in repository: ${Z.path}`)}console.log("")}else E=Z.path;let z=g$(E);if(!z)throw Error("No skill.json found in source directory");let K={installed:[],errors:[],source:Z.original};if(z.skills&&Array.isArray(z.skills)){console.log(`Found ${z.skills.length} skill(s) to update
`);for(let B of z.skills)f$(E,B,W,K)}else{let B=z.name||P$(E).base;f$(y$(E),P$(E).base,W,K)}let G=$Q(E,Z),L=b(G,"agents.json");if(R(L)){let B=G;if(V){let U;try{U=JSON.parse(S$(L,"utf8"))}catch{}let O=U?.repository||Z.original,M=qQ(G,O);if(M)B=M}$q(B,{isUpdate:!0})}if(V&&E)try{let B=E.split("/.agents/tmp/")[0]+"/.agents/tmp/"+E.split("/.agents/tmp/")[1].split("/")[0];F(`rm -rf "${B}"`,{stdio:"pipe"})}catch{}if(console.log(`
**Successfully updated skills:**`),console.log(`- Source: ${K.source}`),K.installed.length>0)for(let B of K.installed)console.log(`  - Updated: ${B.name} at ${B.path}`),console.log(`    ${B.title}`);if(K.errors.length>0){console.log(`
**Errors:**`);for(let B of K.errors)console.log(`  - ${B}`)}if(K.installed.length===0&&K.errors.length===0)console.log("  No skills were updated");if(K.installed.length>0)console.log(`
**Syncing skill symlinks...**`),i$()}catch(z){if(V&&E)try{let K=E.split("/.agents/tmp/")[0]+"/.agents/tmp/"+E.split("/.agents/tmp/")[1].split("/")[0];F(`rm -rf "${K}"`,{stdio:"pipe"})}catch{}console.log(`
Error: ${z.message}`)}},WQ=()=>{let $=process.argv.slice(3),q=$.find((z)=>!z.startsWith("-")),Q=$.filter((z)=>z.startsWith("-"));if(!q){console.log(`Usage: superpowers-agent add-repository <git-url> [options]

Options:
  --global, -g        Add repository globally in ~/.agents/config.json (default)
  --project, -p       Add repository in current project's .agents/config.json
  --as=<alias>        Specify custom alias for the repository

Examples:
  superpowers-agent add-repository https://github.com/example/skills.git
  superpowers-agent add-repository https://github.com/example/skills.git --as=@myskills
  superpowers-agent add-repository https://github.com/example/skills.git --project
  superpowers-agent add-repository https://github.com/example/skills.git --as=@custom --global

Description:
  Adds a skill repository alias to your configuration.
  The repository's skill.json will be read to determine the default alias.
  Use --as to specify a custom alias.
  After adding, you can install skills using: superpowers-agent add @alias path/to/skill`);return}console.log(`Adding repository...
`);let Y=Q.some((z)=>z==="--global"||z==="-g"),X=Q.some((z)=>z==="--project"||z==="-p"),Z=Q.find((z)=>z.startsWith("--as=")),W=Z?Z.split("=")[1]:null,E=X?!1:!0,V;try{console.log(`Cloning repository: ${q}`),V=b(l(),".agents","tmp",`repo-add-${Date.now()}`),F(`mkdir -p "${V}"`,{stdio:"pipe"}),F(`git clone --depth 1 "${q}" "${V}"`,{stdio:"pipe",timeout:30000}),console.log("");let z=g$(V);if(!z)throw Error("No skill.json found in repository");let K;if(W)K=W;else if(z.repository)K=z.repository;else{let B=q.match(/\/([^/]+?)(?:\.git)?$/);if(B)K="@"+B[1];else throw Error("Could not determine repository alias. Use --as=@alias to specify manually.")}Lq(K,q,E),F(`rm -rf "${V}"`,{stdio:"pipe"});let G=E?"globally":"in project",L=E?b(l(),".agents","config.json"):b(process.cwd(),".agents","config.json");console.log(`✓ Repository added ${G}`),console.log(`  Alias: ${K}`),console.log(`  URL: ${q}`),console.log(`  Config: ${L}`),console.log(`
You can now install skills using:`),console.log(`  superpowers-agent add ${K} <path-to-skill>`)}catch(z){if(V)try{F(`rm -rf "${V}"`,{stdio:"pipe"})}catch{}console.log(`
Error: ${z.message}`)}};import{dirname as AX}from"path";var EQ=($)=>{if(!$){console.log(`Usage: superpowers-agent use-skill <skill-name>

Examples (smart matching):
  superpowers-agent use-skill brainstorming              # Matches superpowers:collaboration/brainstorming
  superpowers-agent use-skill collaboration/brainstorming # More specific suffix
  superpowers-agent use-skill test-driven-development    # Matches superpowers:testing/test-driven-development

Examples (explicit paths):
  superpowers-agent use-skill superpowers:collaboration/brainstorming  # Full superpowers skill path
  superpowers-agent use-skill claude:email-assistant                   # Full claude skill path
  superpowers-agent use-skill my-custom-skill                          # Project skill

Smart matching:
  - Type just the skill name or any suffix of the path
  - Priority: .agents/skills/ > .claude/skills/ > ~/.agents/skills/ > ~/.agents/superpowers/skills/
  - If multiple skills match at same priority, you'll see them with descriptions`);return}let q=h($);if(!q){console.log(`Error: Skill not found: ${$}

Available skills:`),console.log("Run: superpowers-agent find-skills");return}let{skillFile:Q,sourceType:Y,actualSkillPath:X}=q;try{let{content:Z,frontmatter:W}=Hq(Q),E=B$[Y].prefix+X,V=AX(Q),z=`# ${W.name||E}`;if(W.description)z+=`
# ${W.description}`;if(W.whenToUse)z+=`
# When to use: ${W.whenToUse}`;z+=`
# Supporting tools and docs are in ${V}
# ============================================

${Z}`,console.log(z)}catch(Z){console.log(Z.message)}};var zQ={bootstrap:sq,version:aq,"check-updates":()=>{lq().catch(($)=>{console.error($.message),process.exit(1)})},update:()=>{let $=process.argv.includes("--no-reinstall");D$({skipReinstall:$})},"config-get":Nq,"config-set":Fq,"setup-skills":rq,"use-skill":()=>EQ(process.argv[3]),execute:Aq,"find-skills":i,add:ZQ,"add-repository":WQ,"list-repositories":Cq,pull:HQ,dir:bq,path:Tq,"get-helpers":Mq,"install-copilot-prompts":r,"install-cursor-commands":t,"install-cursor-hooks":e,"install-codex-prompts":$$,"install-gemini-commands":q$,"install-claude-commands":Q$,"install-opencode-commands":X$,"install-aliases":r$,default:()=>{console.log(`Superpowers for Agents
Usage:
  superpowers-agent bootstrap [--no-update] [--force]               # Run complete bootstrap
  superpowers-agent version                                         # Show current version
  superpowers-agent check-updates                                   # Check for updates
  superpowers-agent update [--no-reinstall]                         # Update to latest version
  superpowers-agent config-get                                      # Show configuration
  superpowers-agent config-set <key> <value>                        # Update configuration
  superpowers-agent setup-skills                                    # Initialize project skills
  superpowers-agent use-skill <skill-name>                          # Load a skill
  superpowers-agent find-skills                                     # List available skills
  superpowers-agent add <url-or-path|@alias> [path] [options]      # Install skills
  superpowers-agent add-repository <git-url> [--as=@alias] [opts]  # Add repository alias
  superpowers-agent list-repositories                              # List configured repository aliases
  superpowers-agent pull <url-or-path|@alias> [path] [options]     # Update skills
  superpowers-agent dir <skill-name>                                # Get skill directory
  superpowers-agent path <skill-name>                               # Get skill file path
  superpowers-agent execute <skill-name>                            # Execute a skill
  superpowers-agent get-helpers <skill> <search-term>               # Get helper file path
  superpowers-agent install-copilot-prompts                         # Install GitHub Copilot prompts
  superpowers-agent install-cursor-commands                         # Install Cursor commands
  superpowers-agent install-cursor-hooks                            # Install Cursor hooks
  superpowers-agent install-codex-prompts                           # Install Codex prompts
  superpowers-agent install-gemini-commands                         # Install Gemini commands
  superpowers-agent install-claude-commands                         # Install Claude commands
  superpowers-agent install-opencode-commands                       # Install OpenCode commands
  superpowers-agent install-aliases                                 # Install universal aliases (superpowers, superpowers-agent)

Documentation: https://github.com/complexthings/superpowers
`)}},TX=process.argv[2]||"default",bX=zQ[TX]||zQ.default;try{bX()}catch($){console.error(`Error: ${$.message}`),process.exit(1)}
